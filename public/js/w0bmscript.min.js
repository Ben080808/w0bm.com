'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),API=function(){function API(){_classCallCheck(this,API)}return _createClass(API,null,[{key:'request',value:function request(b,c,d,f,g){var _this2=this;$.ajax({url:'/api/'+c+'/'+d,method:b?'POST':'GET',data:f,success:function success(h){'null'===h.error?g(!0,null,h.warnings,h):g(!1,_this2.responsify(h.error),h.warnings,h)},error:function error(h){return g(!1,null,null,h)}})}},{key:'responsify',value:function responsify(b){var c=function c(d,f){return{type:d,text:f}};return{not_logged_in:c('error','Not logged in'),invalid_request:c('error','Invalid request'),video_not_found:c('error','Video not found. Perhaps it has already been deleted'),insufficient_permissions:c('error','Insufficient permissions'),no_tags_specified:c('info','No tags specified')}[b]}}]),API}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}var Video=function(){function Video(){_classCallCheck(this,Video);var b=location.href.match(/(\d+)(?!.*\/.)/);b&&(this.id=b[1],this.user=$('.fa-info-circle').next().children().text().trim(),this.tags=$.makeArray($('#tag-display').children().children()).map(function(c){return c.innerText}).filter(function(c){return!!c}),this.api='video',this.apiBase=this.api+'/'+this.id)}return _createClass(Video,[{key:'tag',value:function tag(b,c){var d=this;b.length?API.request(!0,this.apiBase,'tag',{tags:b},function(g,h,j,k){g&&(d.tags=[],d.tags=k.tags.map(function(l){return l.name})),c(g,h,j,k)}):c(!1,API.responsify('no_tags_specified'),null,null)}},{key:'untag',value:function untag(b,c){var d=this;b=b.trim(),b?API.request(!0,this.apiBase,'untag',{tag:b},function(g,h,j,k){g&&(d.tags=[],d.tags=k.tags.map(function(l){return l.name})),c(g,h,j,k)}):c(!1,API.responsify('invalid_request'),null,null)}},{key:'delete',value:function _delete(b,c){b=b.trim(),b?API.request(!0,this.apiBase,'delete',{reason:b},c):c(!1,API.responsify('invalid_request'),null,null)}}]),Video}();var video;$(function(){video=new Video,video.id||(video=null)}),$(function(){$.ajaxSetup({headers:{'X-CSRF-TOKEN':$('meta[name="_token"]').attr('content')}})});function flash(b,c){var d=$('.flashcontainer > .container');'error'===b&&(b='danger'),d.append('<div class="alert alert-:TYPE: alert-dismissable" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>:REPLACE:</div>'.replace(/:TYPE:/,b).replace(/:REPLACE:/,c)),alertrm(jQuery)}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(b){window.setTimeout(b,1000/60)}}(),Array.prototype.average=function(){var b=0;for(var c=0;c<this.length;c++)b+=this[c];return b/this.length};var videoElem=document.getElementById('video');if(null!==videoElem){var player,background,canvas,context,cw,ch;(function(){var b=function b(){videoElem.paused||videoElem.ended||!background||(context.drawImage(videoElem,0,0,cw,ch),window.requestAnimFrame(b))},c=function c(){var f=$('#next');'hidden'!=f.css('visibility')&&f.get(0).click()},d=function d(){var f=$('#prev');'hidden'!=f.css('visibility')&&f.get(0).click()};//Key Bindings
player=videojs(videoElem,{controls:!0,playbackRates:[0.25,0.5,1,1.5,2],inactivityTimeout:0,controlBar:{children:{playToggle:{},progressControl:{},currentTimeDisplay:{},timeDivider:{},durationDisplay:{},volumeControl:{},playbackRateMenuButton:{},fullscreenToggle:{}}}},function(){this.addClass('video-js'),this.volume(0.3),'undefined'!=typeof localStorage&&(this.volume(localStorage.getItem('volume')||0.3),this.on('volumechange',function(){localStorage.setItem('volume',this.volume())}))}),localStorage.getItem('background')==void 0&&($.browser.mobile?localStorage.setItem('background','false'):localStorage.setItem('background','true')),background='true'===localStorage.getItem('background'),canvas=document.getElementById('bg'),context=canvas.getContext('2d'),cw=canvas.width=0|canvas.clientWidth,ch=canvas.height=0|canvas.clientHeight,!background&&$(canvas).css('display','none'),videoElem.addEventListener('play',b),$('#togglebg').on('click',function(f){f.preventDefault(),background=!background,localStorage.setItem('background',background.toString()),background?$(canvas).css('display','block'):$(canvas).css('display','none'),b()}),$(document).on('keydown',function(f){f.defaultPrevented||f.target.nodeName.match(/\b(input|textarea)\b/i)||f.ctrlKey||f.altKey||f.shiftKey||(39==f.keyCode?c():37==f.keyCode?d():65==f.keyCode?d():68==f.keyCode?c():72==f.keyCode?d():76==f.keyCode?c():82==f.keyCode?$('#prev').next().get(0).click():70==f.keyCode?$('#fav').get(0).click():67==f.keyCode?$('.aside').fadeToggle(localStorage.comments='true'!=localStorage.comments):87==f.keyCode||38==f.keyCode?player.volume(player.volume()+0.1):83==f.keyCode||40==f.keyCode?player.volume(player.volume()-0.1):32==f.keyCode&&(player.paused()?player.play():player.pause()))}),$('.wrapper > div:not(.aside)').on('DOMMouseScroll mousewheel',function(f){f.ctrlKey||f.altKey||f.shiftKey||(f.preventDefault(),0>f.deltaY?c():d())})})()}else{var canvas=document.getElementById('bg');canvas.parentNode.removeChild(canvas)}function commentClickableTimestamp(b){if(b.preventDefault(),player){var c=$(b.target).text().match(/(\d{1,2}):(\d{2})/);if(c){var d=60*parseInt(c[1])+parseInt(c[2]);d<=player.duration()&&player.currentTime(d)}}}$(function(){$('.comment_clickable_timestamp').on('click',commentClickableTimestamp)}),function(b){function c(){var o=function o(q,t,u){return q.innerHTML=q.innerHTML.replace(t,u)};k.children().children(':first-of-type').each(function(q,t){o(t,/^nsfw$/i,function(u){return'<span style="color: red;">'+u+'</span>'}),o(t,/^sfw$/i,function(u){return'<span style="color: #23ff00;">'+u+'</span>'})})}function d(o){o.preventDefault(),confirm('Do you really want to delete this tag?')&&video.untag(b(this).siblings().text(),function(q,t,u,w){if(q){flash('success','Tag successfully deleted');var y=[];var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=w.tags[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var z=_step.value;y.push('<span class="label label-default"><a href="/index?q='+z.normalized+'" class="default-link">'+z.name+'</a> <a class="delete-tag default-link" href="#"><i class="fa fa-times"></i></a></span>')}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}k.empty(),k.append(y.join(' ')),b('.delete-tag').on('click',d),c()}else t?flash(t.type,t.text):flash('error','Unknown exception')})}// Comments
var f=b('#commentForm > form'),g='';f.on('submit',function(o){o.preventDefault();// double comment prevention:
var q=f.serialize();return q==g?(alert('nope. just don\'t. seriously... don\'t.'),!1):void(g=q,b.ajax({type:'POST',url:f.attr('action'),data:q}).done(function(t){flash('success','Comment saved successfully'),b('.nocomments').remove();var u=b(t).appendTo('.commentwrapper').find('time.timeago');u.timeago(),u.tooltip(),u.closest('.panel-footer').siblings('.panel-body').find('.comment_clickable_timestamp').on('click',commentClickableTimestamp);var w=f.find('textarea').val('');w.blur()}).fail(function(t){flash('error','Error saving comment'),flash('error',t)}))});//Tags
var h=b('#tags'),j=b('#submittags'),k=b('#tag-display');c(),b('.delete-tag').on('click',d),b('#tags, #filter').on('itemAdded',function(o){return setTimeout(function(){return b(o.currentTarget).siblings('.bootstrap-tagsinput').children('input').val('')},0)}),h.on('beforeItemAdd',function(o){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=video.tags[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var q=_step2.value;q.toLowerCase()===o.item.toLowerCase()&&(o.cancel=!0,flash('info','Tag already exists'))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}),j.on('click touchdown',function(o){o.preventDefault(),video.tag(h.tagsinput('items'),function(q,t,u,w){if(q){flash('success','Tags saved successfully');var y=[];var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=w.tags[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var z=_step3.value;y.push('<span class="label label-default"><a href="/index?q='+z.normalized+'" class="default-link">'+z.name+'</a>'+(w.can_edit_video?' <a class="delete-tag default-link" href="#"><i class="fa fa-times"></i></a>':'')+'</span>')}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}k.empty(),k.append(y.join(' ')),h.tagsinput('removeAll'),b('.delete-tag').on('click',d),c()}else t?flash(t.type,t.text):flash('error','Unknown exception')})});// Filter
var l=b('#filter'),m=b('#submitfilter');m.on('click touchdown',function(o){o.preventDefault(),b.ajax({type:'POST',url:m.attr('href'),data:l.serialize()}).done(function(){flash('success','Filter successfully updated'),b('#filterselectmodal').modal('hide')}).fail(function(q){flash('error','Error updating tags')})})}(jQuery),function(b){function c(g,h){if(b('video').length){var j=[];h.interpret&&j.push(' <strong>Artist:</strong> '+h.interpret),h.songtitle&&j.push(' <strong>Songtitle:</strong> '+h.songtitle),h.imgsource&&j.push(' <strong>Video Source:</strong> '+h.imgsource),h.category.name&&j.push(' <strong>Category:</strong> '+h.category.name),b('span.fa-info-circle').attr('data-content',j.join('<br>'))}else{var k=g.parents('tr');k.find('span').show(),k.find('input, select').hide(),k.find('.vinterpret').html(h.interpret),k.find('.vsongtitle').html(h.songtitle),k.find('.vimgsource').html(h.imgsource),k.find('.vcategory').html('<a href="/'+h.category.shortname+'">'+h.category.name+'</a>')}}var d=b('.indexform, #webmedit');if(b('.indexedit').find('input, select').hide(),d.length){var f=b('tr');f.on('dblclick touchdown',function(g){var h=b(this);h.find('input, select').show(),h.find('span').hide()})}d.on('submit',function(g){var h=b(this);g.preventDefault(),b.ajax({type:'POST',url:h.attr('action'),data:h.serialize()}).done(function(j){flash('success','Video successfully updated'),c(h,j),h.find('#webmeditmodal').modal('hide')}).fail(function(j){flash('error','Error updating video'),flash('error',j),h.find('#webmeditmodal').modal('hide')})})}(jQuery),function(b){var c=b('#fav');c.on('click touchdown',function(d){d.preventDefault(),b.ajax({type:'GET',url:c.attr('href')}).done(function(f){flash('success',f);var g=c.find('i');g.hasClass('fa-heart-o')?(g.removeClass('fa-heart-o'),g.addClass('fa-heart')):(g.removeClass('fa-heart'),g.addClass('fa-heart-o'))})})}(jQuery),function(b){b('#togglebg').on('click touchdown',function(c){c.preventDefault(),b.ajax({dataType:'json',url:b(this).attr('href'),data:{}}).done(function(){b('#bg').toggle()})})}(jQuery),function(b){b(':not(form)[data-confirm]').on('click touchdown',function(){return confirm(b(this).data('confirm'))})}(jQuery),function(b){b('.commentwrapper, .tags').mCustomScrollbar({axis:'y',theme:'minimal',scrollInertia:0})}(jQuery);var alertrm=function alertrm(b){b('.alert').each(function(c){b(this).delay(3000+1000*c).slideUp(300,function(){b(this).remove()})})};alertrm(jQuery),$('#categories').imagesLoaded(function(){$('#categories').isotope({itemSelector:'.category',percentPosition:!0,layoutMode:'masonry'})}),$(function(){$('[data-toggle="popover"]').popover({html:!0,trigger:'manual',container:$(this).attr('id'),placement:'top'}).on('mouseenter',function(){var b=this;$(this).popover('show'),$(this).siblings('.popover').on('mouseleave',function(){$(b).popover('hide')})}).on('mouseleave',function(){var b=this;setTimeout(function(){$('.popover:hover').length||$(b).popover('hide')},100)})}),function(){new Image().src='/images/catfart/cutf.png';var b=document.createElement('div'),c=new Audio;c.addEventListener('pause',function(){b.setAttribute('class','catfart')}),c.addEventListener('play',function(){b.setAttribute('class','catfart farting')}),b.addEventListener('mouseover',function(){c.paused&&(c.src='/images/catfart/pupsi'+(0|28*Math.random())+'.mp3',c.play())}),b.setAttribute('class','catfart'),document.body.appendChild(b)}(),function(){var b=document.getElementById('video');if(null!=b){var c=b.parentNode;c.style.marginBottom='3px';var d=document.createElement('div'),f=document.createElement('div');f.appendChild(d),c.appendChild(f),$(f).css({height:'3px',width:'100%',overflow:'hidden',willChange:'transform',position:'absolute',bottom:'0'}),$(d).css({height:'inherit',width:'inherit',position:'absolute',transform:'translateX(-100%)',backgroundColor:'rgba(31, 178, 176, 0.4)'});var g=function g(){if(requestAnimationFrame(g),!b.paused){var h=100/b.duration*b.currentTime;d.style.transform='translateX('+(-100+h)+'%)'}};g()}}(),function(b){var c=localStorage.comments;c===void 0&&(localStorage.comments=!0),c=c===void 0||'true'===c,b('.aside').toggle(c),b('#toggle').click(function(){b('.aside').fadeToggle(localStorage.comments='true'!=localStorage.comments)})}(jQuery);/\..+\/(?:songindex|user)/i.test(window.location.href)&&function(){var b=function b(c){return[c.clientX+$('div#thumb').width()>=$(window).width()?c.pageX-5-$('div#thumb').width():c.pageX+5,c.clientY+$('div#thumb').height()>=$(window).height()?c.pageY-5-$('div#thumb').height():c.pageY+5]};$(document).ready(function(){$('table tbody tr').on('mouseenter',function(c){var d=$(this).data('thumb'),f=b(c);$(document.body).prepend('<div id="thumb"></div>'),$('div#thumb').prepend('<img id="thumb"/>'),$('img#thumb').text('Loading...'),$('div#thumb').css({position:'absolute',left:f[0],top:f[1],'z-index':'5',border:'1px white solid','box-shadow':'5px 5px 7px 0px rgba(0,0,0,0.75)',color:'white','background-color':'#181818'});var g=$('img#thumb'),h=$('<img/>');h.load(function(){g.attr('src',$(this).attr('src')),f=b(c),$('div#thumb').css({left:f[0],top:f[1]})}),h.attr('src','https://w0bm.com/thumbs/'+d+'.gif')}).on('mousemove',function(c){$('div#thumb').css({left:b(c)[0],top:b(c)[1]})}).on('mouseleave',function(){$('#thumb').remove()})})}();//Pagination
var paginate=function paginate(b,c){var d=c.hash.type||'middle',f='',g=+b.pageCount,h=+b.page,j;c.hash.limit&&(j=+c.hash.limit);//page pageCount
var k={};switch(d){case'middle':if('number'==typeof j){var l=0,m=Math.ceil(j/2)-1,o=j-m-1;h+o>g&&(m=j-(g-h)-1),1>h-m&&(m=h-1);for(var q=h-m;l<j&&l<g;)k={n:q},q==h&&(k.active=!0),f=f+c.fn(k),q++,l++}else for(var l=1;l<=g;l++)k={n:l},l===h&&(k.active=!0),f=f+c.fn(k);break;case'previous':k=1==h?{disabled:!0,n:1}:{n:h-1},f=f+c.fn(k);break;case'next':k={},k=h==g?{disabled:!0,n:g}:{n:h+1},f=f+c.fn(k);break;case'first':k=1==h?{disabled:!0,n:1}:{n:1},f=f+c.fn(k);break;case'last':k=h==g?{disabled:!0,n:g}:{n:g},f=f+c.fn(k);}return f};//enable bootstrap tooltips and timeago
$(function(){var b=$.timeago.settings,c=b.strings;b.refreshMillis=1000,b.allowFuture=!0,b.localeTitle=!0,c.seconds='%d seconds',c.minute='1 minute',c.hour='1 hour',c.hours='%d hours',c.day='1 day',c.month='1 month',c.year='1 year',c.suffixFromNow=null,$('time.timeago').timeago(),$('[data-toggle="tooltip"]').tooltip()});// Notifications
var messagesBadge=$('ul.navbar-right > li > a > span.badge'),activeMessage;0<messagesBadge.text()&&messagesBadge.css('visibility','visible'),/\/user\/.+\/comments/i.test(location.href)?function(b){if('undefined'!=typeof Handlebars){Handlebars.registerHelper('paginate',paginate);var c=Handlebars.compile(b('#comlist').html()),d=Handlebars.compile(b('#paginationtmpl').html()),f=location.href.match(/\/user\/(.+)\/comments/i)[1],g=function g(h){var j='/api/comments';h||(h=j),b.getJSON(h,{username:f}).done(function(k){b('.spinner').hide(),b('#list').html(c(k)),b('time.timeago').timeago(),b('time[data-toggle="tooltip"]').tooltip();var l={pagination:{page:k.current_page,pageCount:k.last_page}};b('#pagination').html(d(l)),b('#pagination a').on('click touchdown',function(m){m.preventDefault(),g(j+'?page='+b(this).data('page'))})})};g()}// only on profilelayout
}(jQuery):function(b){if('undefined'!=typeof Handlebars&&b('#msglist').length){Handlebars.registerHelper('paginate',paginate);var c=Handlebars.compile(b('#msglist').html()),d=Handlebars.compile(b('#msgtmpl').html()),f=Handlebars.compile(b('#paginationtmpl').html()),g={},h=function h(j){var k='/api/messages';j||(j=k),b.getJSON(j).done(function(l){b('.spinner').hide(),g=l,b('#list').html(c(l)),'undefined'!=typeof activeMessage&&b('#listitems a[data-id="'+activeMessage+'"]').addClass('active');var m={pagination:{page:l.current_page,pageCount:l.last_page}};b('#pagination').html(f(m)),b('#pagination a').on('click touchdown',function(o){o.preventDefault(),h(k+'?page='+b(this).data('page'))}),b('#listitems a').on('click touchdown',function(o){o.preventDefault();var q=b(this),t=q.data('index');activeMessage=b(this).data('id'),b('#message').html(d(g.data[t])),g.data[t].read||b.post('/api/messages/read','m_ids[]='+q.data('id')).done(function(u){q.removeClass('list-group-item-info'),messagesBadge.text(messagesBadge.text()-1),0>=messagesBadge.text()&&messagesBadge.css('visibility','hidden')}),b('a').removeClass('active'),q.addClass('active'),b('time.timeago').timeago(),b('time[data-toggle="tooltip"]').tooltip()})})};h()}// only on profilelayout
}(jQuery);function readAll(){$.ajax({url:'/api/messages/readall',success:function success(b){1==b?(flash('success','Marked all messages as read'),$('.list-group-item-info').removeClass('list-group-item-info'),messagesBadge.text('0'),messagesBadge.css('visibility','hidden')):(flash('error','Failed to mark all messages as read'),flash('error',b))},error:function error(b,c,d){flash('error','Failed to mark all messages as read'),flash('error',c),flash('error',d)}})}$('ul.dropdown-menu').on('click touchdown',function(b){b.stopPropagation()});function deleteComment(b){var c=b.closest('div[data-id]'),d=c.data('id'),f=$(c.children('.panel-footer').children('a')[0]).text();do{var g=prompt('Reason for deleting comment '+d+' by '+f);if(null===g)return;g=g.trim()}while(!g);$.ajax({url:'/api/comments/'+d+'/delete',method:'POST',data:{reason:g},success:function success(h){'success'==h?(flash('success','Comment deleted'),c.removeClass('panel-default').addClass('panel-danger'),c.find('.panel-footer').children('a[onclick="deleteComment($(this))"]').replaceWith('<a href="#" onclick="restoreComment($(this))"><i style="color:green"; class="fa fa-refresh" aria-hidden="true"></i></a>'),c.find('.panel-footer > a[onclick="editComment($(this))"]').remove()):'invalid_request'==h?flash('error','Invalid request'):'not_logged_in'==h?flash('error','Not logged in'):'insufficient_permissions'==h?flash('error','Insufficient permissions'):flash('error','Unknown exception')},error:function error(h,j,k){flash('error','Unknwon exception'),flash('error',j),flash('error',k)}})}function restoreComment(b){var c=b.closest('div[data-id]'),d=c.data('id'),f=$(c.children('.panel-footer').children('a')[0]).text();do{var g=prompt('Reason for restoring comment '+d+' by '+f);if(null===g)return;g=g.trim()}while(!g);$.ajax({url:'/api/comments/'+d+'/restore',method:'POST',data:{reason:g},success:function success(h){'success'==h?(flash('success','Comment restored'),c.removeClass('panel-danger').addClass('panel-default'),c.find('.panel-footer').children('a[onclick]').replaceWith('<a href="#" onclick="deleteComment($(this))"><i style="color:red"; class="fa fa-times" aria-hidden="true"></i></a> <a href="#" onclick="editComment($(this))"><i style="color:cyan;" class="fa fa-pencil-square" aria-hidden="true"></i></a>')):'invalid_request'==h?flash('error','Invalid request'):'not_logged_in'==h?flash('error','Not logged in'):'insufficient_permissions'==h?flash('error','Insufficient permissions'):'comment_not_deleted'==h?flash('error','Comment is not deleted'):flash('error','Unknown exception')},error:function error(h,j,k){flash('error','Failed restoring comment'),flash('error',j),flash('error',k)}})}function editComment(b){var c=b.closest('div[data-id]'),d=c.find('.panel-body'),f=c.data('id');$.ajax({url:'/api/comments/'+f,success:function success(g){if('null'==g.error){var h=$('<textarea class="form-control">');d.replaceWith(h),h.val($('<div>').html(g.comment).text()),b.prev().remove(),b.replaceWith('<a href="#" class="saveCommentEdit"><i class="fa fa-floppy-o" aria-hidden="true"></i></a> <a href="#" class="abortCommentEdit"><i style="color:red;" class="fa fa-ban" aria-hidden="true"></i></a>'),c.find('.abortCommentEdit').on('click',function(j){j.preventDefault(),$(this).prev().remove(),$(this).replaceWith('<a href="#" onclick="deleteComment($(this))"><i style="color:red"; class="fa fa-times" aria-hidden="true"></i></a> <a href="#" onclick="editComment($(this))"><i style="color:cyan;" class="fa fa-pencil-square" aria-hidden="true"></i></a>'),h.replaceWith(d)}),c.find('.saveCommentEdit').on('click',function(j){j.preventDefault();var k=$(this);$.ajax({url:'/api/comments/'+f+'/edit',method:'POST',data:{comment:h.val()},success:function success(l){'null'==l.error?(d.html(l.rendered_comment),flash('success','Comment edited successfully'),d.find('.comment_clickable_timestamp').on('click',commentClickableTimestamp)):'invalid_request'==l.error?flash('error','Invalid request was sent by your browser'):'not_logged_in'==l.error?flash('error','Not logged in'):'insufficient_permissions'==l.error?flash('error','Insufficient permissions'):'comment_not_found'==l.error?flash('error','Comment does not exist'):flash('error','Unknown exception')},error:function error(l,m,o){flash('error','Unknown exception'),flash('error',m),flash('error',o)},complete:function complete(){h.replaceWith(d),k.next().remove(),k.replaceWith('<a href="#" onclick="deleteComment($(this))"><i style="color:red"; class="fa fa-times" aria-hidden="true"></i></a> <a href="#" onclick="editComment($(this))"><i style="color:cyan;" class="fa fa-pencil-square" aria-hidden="true"></i></a>')}})})}else'comment_not_found'==g.error?flash('error','Comment does not exist'):flash('error','Unknown exception')},error:function error(g,h,j){flash('error','Failed receiving non-rendered comment from API'),flash('error',h),flash('error',j)}})}$(function(){var b=$('.vjs-control-bar'),c=!1;$('video').on('mousemove',function(){c||(b.css('display','flex'),c=!0)}).on('mouseleave',function(d){$(d.relatedTarget).is('[class^="vjs"]')||!c||(b.hide(),c=!1)}),$('[class^="vjs"]').on('mouseleave',function(d){d.relatedTarget==$('video').get(0)||$(d.relatedTarget).is('[class^="vjs"]')||!c||(b.hide(),c=!1)})}),$(function(){if(/\/upload/.test(location.href)){var k,l,m,o,q,t,u,w,y;(function(){var b=function b(){$('#dragndrop').css({color:l,'border-color':m,'background-color':o})},c=function c(z){var A=Math.floor(Math.log(z)/Math.log(1024));return(z/Math.pow(1024,A)).toFixed(2)+' '+['B','kB','MB','GB','TB','PB','EB','ZB','YB'][A]},d=function d(z){z.preventDefault(),$('input[type="file"]').trigger('click')},f=function f(){$('#dragndrop-link').on('click',d),$('#dragndrop-link').attr('href','#'),$('#dragndrop-text').html(k)},g=function g(z){$('#dragndrop-link').removeAttr('href').off('click'),$('#dragndrop-text').html('<video id="video_preview" src="'+URL.createObjectURL(z)+'" autoplay controls loop></video><br><span class="upload-info">'+z.name+' &mdash; '+c(z.size)+' &mdash; <a id="dragndrop-clear" class="fa fa-times" href="#"></a></span><br><div class="progress progress-striped" style="display: none; margin-left: 10px; margin-right: 10px;"><div class="progress-bar progress-bar-custom" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><span class="upload-info sr-only">0%</span></div></div><span class="upload-info"><span id="upload-stats" style="display: none;"></span></span>'),$('#video_preview').prop('volume',0),$('#dragndrop-clear').on('click',function(A){A.preventDefault(),A.stopPropagation(),t=null,$(this).off('click'),b(),f(),u&&'abort'!=u.statusText&&(u.abort(),u=null)})},h=function h(z){var A=31457280<z.size,B='video/webm'!==z.type;return A&&$('#dragndrop').data('uploadlimit')||B?(flash('error',B?'Invalid file':'File too big. Max 30MB'),b(),!1):!0},j=function j(z,A,B,C,D,E){function F(){var L=0,M=H.length,N;for(N=I;N<M;N++)L+=H[N];L=L/(N-I),I=N,$('#upload-stats').text('Speed: '+c(Math.floor(L))+'/s Uploaded: '+c(G.loaded))}var G={loaded:0,secondsElapsed:0},H=[],I=0,J,K=new FormData;K.append('interpret',z),K.append('songtitle',A),K.append('imgsource',B),K.append('category',C),K.append('tags',D),K.append('file',E),$('.progress-striped, #upload-stats').css('opacity',0).slideDown('fast').animate({opacity:1},{queue:!1,duration:'fast'}),u=$.ajax({url:'/api/upload',type:'POST',data:K,processData:!1,contentType:!1,success:function success(L){switch(L.error){case'null':L.video_id?(flash('success','Upload successful: <a href="/'+L.video_id+'">/'+L.video_id+'</a>. Redirect in 3 seconds...'),setTimeout(function(){location.href='/'+L.video_id},3000)):flash('error','Unexpected Exception');break;case'invalid_request':flash('error','Invalid request');break;case'not_logged_in':flash('error','Not logged in');break;case'uploadlimit_reached':flash('error','Uploadlimit reached');break;case'invalid_file':flash('error','Invalid file');break;case'file_too_big':flash('error','File too big. Max 30MB');break;case'already_exists':L.video_id?flash('error','Video already exists: <a href="/'+L.video_id+'">/'+L.video_id+'</a>'):flash('error','Video already existed but has been deleted');break;case'erroneous_file_encoding':flash('error','Erroneous file encoding. <a href="/webm">Try reencoding it</a>');break;default:flash('error','Unexpected exception');}'null'!=L.error&&($('.progress-bar-custom').css('background-color','red'),$('.progress-bar-custom').text('Upload failed')),$('#upload-stats').text('Speed: '+c(Math.floor(H.average()))+'/s Uploaded: '+c(t.size))},error:function error(L,M,N){return L=null,'abort'==N?void flash('info','Upload aborted'):void(flash('error','Upload failed'),flash('error',M),flash('error',N),$('.progress-bar-custom').css('background-color','red'),$('.progress-bar-custom').text('Upload failed'))},complete:function complete(){clearInterval(J)},xhr:function xhr(){var L=$.ajaxSettings.xhr(),M=new Date;return $('.progress-bar-custom').css('background-color','rgba(47, 196, 47, 1)'),L.upload.onprogress=function(N){var O=Math.floor(100*(N.loaded/N.total)),P=(new Date().getTime()-M.getTime())/1000,Q=(N.loaded-G.loaded)/(P-G.secondsElapsed);$('.progress-bar-custom').css('width',O+'%'),$('.progress-bar-custom').text(O+'%'),G.secondsElapsed=P,G.loaded=N.loaded,H.push(Q),J||(F(),J=setInterval(F,500))},L}})};k=$('#dragndrop-text').html(),l=$('#dragndrop').css('color'),m=$('#dragndrop').css('border-left-color'),o=$('#dragndrop').css('background-color'),q=0,w=$('#tags_upload'),y=$('#nsfw'),$('input[type="file"]').on('change',function(z){if(this.files.length){var A=this.files[0];h(A)&&(t=A,g(A)),$(this).wrap('<form>').closest('form').get(0).reset(),$(this).unwrap()}}),$('#dragndrop-link').on('click',d),$(document).on('dragenter',function(z){z.preventDefault(),q++;var A=z.originalEvent.dataTransfer;null!=A.types&&(A.types.indexOf?0===A.types.indexOf('Files'):A.types.contains('application/x-moz-file'))&&$('#dragndrop').css({color:'#BBB','border-color':'#656464','background-color':'#323234'})}).on('dragleave',function(){q--,0===q&&b()}).on('dragover',function(z){z.preventDefault()}).on('drop',function(z){z.preventDefault(),$(z.target).is('#dragndrop-text')||b()}),$('#dragndrop-text').on('dragover',function(z){var A=z.originalEvent.dataTransfer,B=A.effectAllowed;A.dropEffect='move'===B||'linkMove'===B?'move':'copy'}).on('drop',function(z){if(z.originalEvent.dataTransfer.files.length){u&&'abort'!=u.statusText&&(u.abort(),t=null,f());var A=z.originalEvent.dataTransfer.files[0];b(),h(A)&&(t=A,g(A),q=0)}}),$('button#btn-upload').on('click',function(){return t?u&&(0==u.readyState||1==u.readyState||3==u.readyState)?void flash('info','Already uploading'):void j($('#interpret').val(),$('#songtitle').val(),$('#imgsource').val(),$('#category').val(),w.tagsinput('items'),t):void flash('error','No file selected')}),w.on('itemRemoved',function(z){'nsfw'===z.item?(y.prop('checked',!1),$(this).tagsinput('add','sfw')):'sfw'===z.item&&(y.prop('checked',!0),$(this).tagsinput('add','nsfw'))}),y.on('change',function(){this.checked?(w.tagsinput('remove','sfw'),w.tagsinput('add','nsfw')):(w.tagsinput('remove','nsfw'),w.tagsinput('add','sfw'))}),y.trigger('change')})()}}),$(function(){$('#delete_video').on('click',function(b){b.preventDefault();do{var c=prompt('Reason for deleting video '+video.id+' by '+video.user);if(null===c)return;c=c.trim()}while(!c);video.delete(c,function(d,f,g){if(d){flash('success','Video deleted. Redirect in 3 seconds...'),setTimeout(function(){return location.href='/'},3000);var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=g[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var h=_step4.value;flash('warning',h)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}else f?flash(f.type,f.text):flash('error','Unknown exception')})})});
